<Window x:Class="ЭМК.MedicalCaseWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ЭМК"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes" 
        mc:Ignorable="d"
        Title="ЭМК" Height="1300" Width="1200" WindowStartupLocation="CenterScreen" WindowState="Maximized" Icon="Image/medical_monitor_icon.ico">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!--Заголовок случая-->
        <Border Grid.Row="0" Background="#FF3F51B5" Padding="10" CornerRadius="5">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Амбулаторный случай " Foreground="White" FontSize="16" FontWeight="Bold" Margin="0,0,20,0"/>
                <TextBlock x:Name="NumberTextBlock" Foreground="White" FontSize="16" FontWeight="Bold" Margin="0,0,20,0"/>
                <TextBlock Text="&lt;Добавление&gt;" Foreground="White" FontSize="16" FontStyle="Italic"/>
                <TextBlock x:Name="IDPatientTextBlock" Foreground="White" FontSize="16" FontWeight="Bold" Margin="20,0,20,0" Visibility="Hidden"/>
            </StackPanel>
        </Border>

        <!--Информация о пациенте-->
        <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="1" Margin="0,10" Padding="10">
            <StackPanel>
                <StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock x:Name="txtPatientName" FontWeight="Bold" FontSize="14"/>
                        <TextBlock x:Name="txtPatientBirthDate" FontWeight="Bold" FontSize="14" Margin="10,0,0,0"/>
                        <TextBlock Text="(" FontWeight="Bold" FontSize="14" Margin="10,0,0,0"/>
                        <TextBlock x:Name="txtPatientAge" FontWeight="Bold" FontSize="14" Margin="5,0,0,0"/>
                        <TextBlock Text=")" FontWeight="Bold" FontSize="14" Margin="5,0,0,0"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ЕНП " Margin="0,5,0,0"/>
                        <TextBlock x:Name="txtPatientEnp" FontWeight="Bold" Margin="0,5,0,0"/>

                        <TextBlock Text="СНИЛС " Margin="10,5,0,0"/>
                        <TextBlock x:Name="txtPatientSnils" FontWeight="Bold" Margin="0,5,0,0"/>
                    </StackPanel>

                    <Grid Margin="0,10,0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Дата приема*" FontWeight="Bold"/>
                        <TextBlock Text="Время*" Grid.Column="1" FontWeight="Bold"/>
                        <TextBlock Text="Место обслуживания*" Grid.Column="2" FontWeight="Bold"/>
                        <TextBlock Text="Врач*" Grid.Column="3" FontWeight="Bold"/>


                        <DatePicker Text="12.04.2021" Width="150" HorizontalAlignment="Left" x:Name="dateTextBlock" Grid.Row="1" Margin="0,5,0,0"/>
                        <StackPanel Grid.Column="1"  Grid.Row="1">
                            <materialDesign:TimePicker x:Name="timePicker" 
                                  Grid.Row="1" Grid.Column="1" 
                                  Margin="0,5,0,0"
                                  Width="150" 
                                  HorizontalAlignment="Left"
                                  SelectedTime="{Binding SelectedTime, Mode=TwoWay}"
                                  Is24Hours="True"
                                    materialDesign:HintAssist.Hint="Время приема">
                            </materialDesign:TimePicker>
                        </StackPanel>

                        <TextBlock Text="" Grid.Row="1" Grid.Column="2" />

                        <ComboBox x:Name="cmbPlaceOfService" Grid.Row="1" Grid.Column="2" Margin="0,5,0,0" Width="200" HorizontalAlignment="Left" SelectedIndex="0" ToolTip="Выберите место обслуживания">
                            <ComboBoxItem Content="1 - Поликлиника"/>
                            <ComboBoxItem Content="2 - На дому"/>
                        </ComboBox>
                        <TextBlock x:Name="txtDoctorInfo" Grid.Row="1" Grid.Column="3" Margin="0,5,0,0"/>
                    </Grid>

                    <Grid Margin="0, 5, 0, 0">
                        <!-- Определение строк и столбцов сетки -->
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- ЗАГОЛОВКИ ПОЛЕЙ -->
                        <TextBlock Text="Тип случая обслуживания*" FontWeight="Bold" ToolTip="Выберите тип обращения пациента"/>
                        <TextBlock Text="Вид оплаты*" Grid.Column="1" FontWeight="Bold" ToolTip="Выберите источник финансирования услуги"/>
                        <TextBlock Text="Цель обслуживания*" Grid.Column="2" FontWeight="Bold" ToolTip="Укажите цель визита пациента"/>

                        <!-- 1. Тип случая обслуживания -->
                        <ComboBox x:Name="cmbServiceType" Grid.Row="1" Margin="0,5,0,0" Width="200" HorizontalAlignment="Left" SelectedIndex="0" ToolTip="Выберите тип обращения пациента">
                            <ComboBoxItem Content="1 - Первичный"/>
                            <ComboBoxItem Content="2 - Повторный"/>
                        </ComboBox>

                        <!-- 2. Вид оплаты -->
                        <ComboBox x:Name="cmbTypeOfPayment" Grid.Row="1" Grid.Column="1" Margin="0,5,0,0" 
                                  Width="340" HorizontalAlignment="Left" SelectedIndex="0" 
                                  ToolTip="Выберите источник финансирования медицинской услуги">
                            <ComboBoxItem Content="ОМС"/>
                            <ComboBoxItem Content="ДМС"/>
                            <ComboBoxItem Content="Средства пациента"/>
                            <ComboBoxItem Content="Третье лицо (физическое)"/>
                            <ComboBoxItem Content="Третье лицо (юридическое)"/>
                            <ComboBoxItem Content="Бюджет федеральный"/>
                            <ComboBoxItem Content="Бюджет региональный"/>
                            <ComboBoxItem Content="ФСС"/>
                            <ComboBoxItem Content="Бюджет медицинской организации"/>
                            <ComboBoxItem Content="Бюджет федеральный и региональный"/>
                            <ComboBoxItem Content="Средства неподведомственных организаций"/>
                        </ComboBox>

                        <!-- 3. Цель обслуживания -->
                        <ComboBox x:Name="cmbServicePurpose" Grid.Row="1" Grid.Column="2" Margin="2,5,-2,0" 
                                  SelectedIndex="0" ToolTip="Укажите цель визита пациента" VerticalAlignment="Top">
                            <ComboBoxItem Content="1 - Лечебно-диагностическая"/>
                            <ComboBoxItem Content="2 - Консультативная"/>
                            <ComboBoxItem Content="3 - Диспансерное наблюдение"/>
                            <ComboBoxItem Content="4 - Профосмотр"/>
                            <ComboBoxItem Content="5 - Прочие цели"/>
                            <ComboBoxItem Content="6 - Диспансеризация студентов"/>
                            <ComboBoxItem Content="7 - Телемедицинская консультация"/>
                            <ComboBoxItem Content="8 - Диспансеризация детей-сирот"/>
                            <ComboBoxItem Content="9 - Диспансеризация детей из патронатных семей"/>
                            <ComboBoxItem Content="10 - Посещение для оказания неотложных семей"/>
                            <ComboBoxItem Content="11 - Первичное обращение в травматологический пункт"/>
                            <ComboBoxItem Content="12 - Посещение центра здоровья"/>
                            <ComboBoxItem Content="13 - Патронаж"/>
                            <ComboBoxItem Content="14 - Профцель"/>
                            <ComboBoxItem Content="15 - Определение РНК коронавируса ТОРС (SARS-CoV)"/>
                            />
                        </ComboBox>
                    </Grid>

                </StackPanel>
                <StackPanel/>
            </StackPanel>
        </Border>

        <!--Основная информация-->
        <TabControl Grid.Row="2">
            <TabItem Header="Осмотр" Height="40">
                <ScrollViewer>
                    <StackPanel Margin="10,5,10,10">

                        <StackPanel Margin="0,0,0,0">
                            <!-- Диагнозы -->
                            <StackPanel Margin="0,10,0,0">
                                <TextBlock Text="Жалобы:*" FontWeight="Bold" Margin="0,0,0,5"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Поле для ввода жалоб -->
                                    <ComboBox x:Name="ComplaintsComboBox"
                                           IsEditable="True"
                                           ItemsSource="{Binding AvailableComplaints}"
                                           Text="{Binding CurrentComplaint, UpdateSourceTrigger=PropertyChanged}"
                                           Margin="0,0,5,0" Cursor=""/>

                                    <!-- Кнопка добавления -->
                                    <Button Grid.Column="1"
                                         Content="Добавить"
                                         Click="AddComplaintButton_Click"
                                         Padding="5,2"
                                         TextBlock.Foreground="Black"
                                         Background="White"/>
                                </Grid>

                                <!-- Поле для отображения всех жалоб через запятую -->
                                <TextBox x:Name="ComplaintsTextBox"
                                      IsReadOnly="True"
                                      Margin="0,5,0,0"
                                      TextWrapping="Wrap"
                                      MinHeight="40"
                                      VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>

                            <TextBlock Text="Анамнез:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="tbMedicalHistory" Text="Перенесенные заболевания: Хранические заболевания отрицает." Margin="10,0,0,0"/>
                            <TextBox x:Name="tbMedicalHistory1" Text="Эпидемиологический анамнез: Туберкулез, непатиты, ВИЧ, венерические и другие инфекционные заболевания отрицает." Margin="10,0,0,0"/>
                            <TextBox x:Name="tbMedicalHistory2" Text="Аллергический анамнез: спокойный." Margin="10,0,0,0"/>
                            <TextBox x:Name="tbMedicalHistory3" Text="Наследственность: не отягощена." Margin="10,0,0,0"/>

                            <!-- Объективный статус -->
                            <StackPanel Margin="0,10,0,0">
                                <TextBlock Text="Объективный статус:" FontWeight="Bold" Margin="0,0,0,5"/>

                                <Border BorderBrush="LightGray" BorderThickness="1" Padding="5">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Общие сведения -->
                                        <TextBlock Text="Общие сведения, витальные параметры и антропометрия:" FontWeight="Bold" Grid.Row="0"/>

                                        <Grid Grid.Row="1" Margin="0,5,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Text="Рост (см):" Grid.Column="0" Margin="0,5,10,0"/>
                                            <!-- Поле для ввода роста с подсказкой -->
                                            <Grid Grid.Column="1" Margin="5,0,10,0" Width="80">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="20"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBox x:Name="txtHeight" Text="160" 
                                                         PreviewTextInput="TxtHeight_PreviewTextInput" 
                                                         VerticalContentAlignment="Center"/>

                                                <StackPanel Grid.Column="1" Orientation="Vertical">
                                                    <Button Content="▲" Background="White" Height="15" Click="HeightUp_Click"/>
                                                    <Button Content="▼" Height="15" Click="HeightDown_Click"/>
                                                </StackPanel>
                                            </Grid>

                                            <TextBlock Text="Вес (кг):" Grid.Column="2" Margin="20,5,0,0"/>
                                            <Grid Grid.Column="3" Margin="20,0,10,0" Width="80">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="20"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBox x:Name="txtWeight" Text="60" 
                                                      PreviewTextInput="TxtHeight_PreviewTextInput"
                                                      VerticalContentAlignment="Center"/>

                                                <StackPanel Grid.Column="1" Orientation="Vertical">
                                                    <Button Content="▲" Background="White" Height="15" Click="WeightUp_Click"/>
                                                    <Button Content="▼" Height="15" Click="WeightDown_Click"/>
                                                </StackPanel>
                                            </Grid>

                                            <TextBlock Text="АД:" Grid.Column="4"  Margin="20,5,0,0"/>
                                            <Grid Grid.Column="5" Margin="20,0,10,0" Width="80" x:Name="BloodPressureUpperGrid">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="20"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBox x:Name="txtBloodPressureUpper" Text="120" 
                                                      PreviewTextInput="TxtHeight_PreviewTextInput"
                                                      VerticalContentAlignment="Center"/>

                                                <StackPanel Grid.Column="1" Orientation="Vertical">
                                                    <Button Content="▲" Background="White" Height="15" Click="BloodPressureUpperUp_Click"/>
                                                    <Button Content="▼" Height="15" Click="BloodPressureUpperDown_Click"/>
                                                </StackPanel>
                                            </Grid>

                                            <TextBlock Text="/" Grid.Column="6"  Margin="5,5,0,0"/>
                                            <Grid Grid.Column="7" Margin="10,0,10,0" Width="80">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="20"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBox x:Name="txtBloodPressureLower" Text="80" 
                                                      PreviewTextInput="TxtHeight_PreviewTextInput"
                                                      VerticalContentAlignment="Center"/>

                                                <StackPanel Grid.Column="1" Orientation="Vertical">
                                                    <Button Content="▲" Background="White" Height="15" Click="BloodPressureLowerUp_Click"/>
                                                    <Button Content="▼" Height="15" Click="BloodPressureLowerDown_Click"/>
                                                </StackPanel>
                                            </Grid>

                                            <TextBlock Text="Температура (°C)" Grid.Column="8"  Margin="5,5,0,0"/>
                                            <Grid Grid.Column="9" Margin="20,0,10,0" Width="80">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="20"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBox x:Name="txtTemperature" Text="36.6"                                                       
                                                      PreviewTextInput="TxtTemperature_PreviewTextInput"
                                                      TextChanged="TxtTemperature_TextChanged"
                                                      VerticalContentAlignment="Center"/>

                                                <StackPanel Grid.Column="1" Orientation="Vertical">
                                                    <Button Content="▲" Background="White" Height="15" Click="TemperatureUp_Click"/>
                                                    <Button Content="▼" Height="15" Click="TemperatureDown_Click"/>
                                                </StackPanel>
                                            </Grid>
                                        </Grid>

                                        <!-- Вторая строка параметров -->
                                        <Grid Grid.Row="2" Margin="0,10,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Text="ЧСС (уд/мин):" Grid.Column="0" Margin="0,5,0,0"/>
                                            <Grid Grid.Column="1" Margin="20,0,10,0" Width="80" >
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="20"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBox x:Name="txtHeartRate" Text="73" 
                                                      PreviewTextInput="TxtHeight_PreviewTextInput"
                                                      VerticalContentAlignment="Center"/>

                                                <StackPanel Grid.Column="1" Orientation="Vertical">
                                                    <Button Content="▲" Background="White" Height="15" Click="HeartRateUp_Click"/>
                                                    <Button Content="▼" Height="15" Click="HeartRateDown_Click"/>
                                                </StackPanel>
                                            </Grid>

                                            <TextBlock Text="ЧДД: (в мин):" Grid.Column="2" Margin="0,5,0,0"/>
                                            <Grid Grid.Column="3" Margin="20,0,10,0" Width="80" x:Name="RespiratoryRateGrid">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="20"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBox x:Name="txtRespiratoryRate" Text="20"  
                                                       PreviewTextInput="TxtHeight_PreviewTextInput"
                                                       VerticalContentAlignment="Center"/>

                                                <StackPanel Grid.Column="1" Orientation="Vertical">
                                                    <Button Content="▲" Background="White" Height="15" Click="RespiratoryRateUp_Click"/>
                                                    <Button Content="▼" Height="15" Click="RespiratoryRateDown_Click"/>
                                                </StackPanel>
                                            </Grid>

                                            <TextBlock Text="SpO2: (%):" Grid.Column="4" Margin="0,5,0,0"/>
                                            <Grid Grid.Column="5" Margin="20,0,10,0" Width="80">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="20"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBox x:Name="txtOxygenSaturation" Text="20" 
                                                      PreviewTextInput="TxtHeight_PreviewTextInput"
                                                      VerticalContentAlignment="Center"/>

                                                <StackPanel Grid.Column="1" Orientation="Vertical">
                                                    <Button Content="▲" Background="White" Height="15" Click="OxygenSaturationUp_Click"/>
                                                    <Button Content="▼" Height="15" Click="OxygenSaturationDown_Click"/>
                                                </StackPanel>
                                            </Grid>
                                        </Grid>
                                    </Grid>
                                </Border>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                <CheckBox x:Name="ZnoCheckBox" FontWeight="Bold" Content="Подозрение на ЗНО" Margin="0,2,0,10"/>

                                <TextBlock Text="Состояние пациента:*" FontWeight="Bold" Margin="50,5,0,5"/>
                                <ComboBox x:Name="cmbPatientCondition" Grid.Row="1" Margin="20,5,0,0" Width="200" 
                                          HorizontalAlignment="Left" SelectedIndex="0" ToolTip="Выберите состояние пациента">
                                    <ComboBoxItem Content="Удовлетворительное"/>
                                    <ComboBoxItem Content="Средней тяжести"/>
                                    <ComboBoxItem Content="Тяжелое"/>
                                    <ComboBoxItem Content="Крайне тяжелое"/>
                                    <ComboBoxItem Content="Клиническая смерть"/>
                                    <ComboBoxItem Content="Терминальное (Агональное)"/>
                                </ComboBox>
                            </StackPanel>

                            <!-- Предварительный диагноз -->
                            <TextBlock Text="Предварительный диагноз:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ComboBox x:Name="cbPreliminaryDiagnosis" 
                                   Margin="0,0,0,10"
                                   IsEditable="True"
                                   IsTextSearchEnabled="True"
                                   TextSearch.TextPath="Code"
                                   StaysOpenOnEdit="True"
                                   ToolTip="Выберите диагноз по МКБ-10"
                                   PreviewKeyUp="DiagnosisComboBox_PreviewKeyUp">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Code}" FontWeight="Bold" Width="60"/>
                                            <TextBlock Text="{Binding Name}" Margin="5,0,0,0"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                            <!-- Основной диагноз -->
                            <TextBlock Text="Основной диагноз:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <ComboBox x:Name="cbMainDiagnosis" 
                                   Margin="0,0,0,10"
                                   IsEditable="True"
                                   IsTextSearchEnabled="True"
                                   TextSearch.TextPath="Code"
                                   StaysOpenOnEdit="True"
                                   ToolTip="Выберите диагноз по МКБ-10"
                                   PreviewKeyUp="DiagnosisComboBox_PreviewKeyUp">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Code}" FontWeight="Bold" Width="60"/>
                                            <TextBlock Text="{Binding Name}" Margin="5,0,0,0"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                            <TextBlock Text="Лечение:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="tbTreatment" Margin="0,0,0,5"/>

                            <TextBlock Text="Рекомендации:" FontWeight="Bold" Margin="0,0,0,5"/>
                            <TextBox x:Name="tbRecommendations" Margin="0,0,0,10"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Направления">
                <ScrollViewer>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Форма направления -->
                        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                            <Grid Margin="10" x:Name="PrintContent">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Шапка направления -->
                                <StackPanel Grid.Row="0" Grid.ColumnSpan="2" HorizontalAlignment="Center">
                                    <TextBlock Text="НАПРАВЛЕНИЕ" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="№ 3 от "/>
                                        <TextBlock x:Name="DateNaprTB"/>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Данные пациента -->
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Пациент:" Margin="5"/>
                                <TextBox Grid.Row="1" Grid.Column="1" x:Name="PatientNameTextBox" Margin="5"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Дата рождения:" Margin="5,10,10,10"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" x:Name="PatientBirthDatePicker" Margin="10"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Направлен в:" Margin="5"/>
                                <ComboBox Grid.Row="3" Grid.Column="1" x:Name="DirectionComboBox" Margin="5"
                                          TextSearch.TextPath="Content"
                                          IsEditable="True"
                                          IsTextSearchEnabled="True"
                                          StaysOpenOnEdit="True"
                                          ToolTip="Выберите или введите вид направления">
                                    <!-- Консультации специалистов -->
                                    <ComboBoxItem Content="Консультация кардиолога"/>
                                    <ComboBoxItem Content="Консультация невролога"/>
                                    <ComboBoxItem Content="Консультация эндокринолога"/>
                                    <ComboBoxItem Content="Консультация гастроэнтеролога"/>
                                    <ComboBoxItem Content="Консультация пульмонолога"/>
                                    <ComboBoxItem Content="Консультация ревматолога"/>
                                    <ComboBoxItem Content="Консультация нефролога"/>
                                    <ComboBoxItem Content="Консультация гематолога"/>
                                    <ComboBoxItem Content="Консультация аллерголога-иммунолога"/>
                                    <ComboBoxItem Content="Консультация инфекциониста"/>

                                    <!-- Инструментальные исследования -->
                                    <ComboBoxItem Content="Рентгенография"/>
                                    <ComboBoxItem Content="Флюорография"/>
                                    <ComboBoxItem Content="Компьютерная томография (КТ)"/>
                                    <ComboBoxItem Content="Магнитно-резонансная томография (МРТ)"/>
                                    <ComboBoxItem Content="Ультразвуковое исследование (УЗИ)"/>
                                    <ComboBoxItem Content="Эхокардиография (ЭхоКГ)"/>
                                    <ComboBoxItem Content="Электроэнцефалография (ЭЭГ)"/>
                                    <ComboBoxItem Content="Электрокардиография (ЭКГ)"/>
                                    <ComboBoxItem Content="Суточное мониторирование ЭКГ (Холтер)"/>
                                    <ComboBoxItem Content="Спирометрия"/>

                                    <!-- Лабораторные исследования -->
                                    <ComboBoxItem Content="Общий анализ крови"/>
                                    <ComboBoxItem Content="Биохимический анализ крови"/>
                                    <ComboBoxItem Content="Коагулограмма"/>
                                    <ComboBoxItem Content="Гормональные исследования"/>
                                    <ComboBoxItem Content="Общий анализ мочи"/>
                                    <ComboBoxItem Content="Анализ мочи по Нечипоренко"/>
                                    <ComboBoxItem Content="Анализ кала (копрограмма)"/>
                                    <ComboBoxItem Content="Микробиологические исследования"/>

                                    <!-- Процедуры и манипуляции -->
                                    <ComboBoxItem Content="Физиотерапия"/>
                                    <ComboBoxItem Content="Массаж"/>
                                    <ComboBoxItem Content="Лечебная физкультура (ЛФК)"/>
                                    <ComboBoxItem Content="Иглорефлексотерапия"/>
                                    <ComboBoxItem Content="Перевязка"/>
                                    <ComboBoxItem Content="Капельница"/>

                                    <!-- Специализированные исследования -->
                                    <ComboBoxItem Content="Колоноскопия"/>
                                    <ComboBoxItem Content="Гастроскопия (ФГДС)"/>
                                    <ComboBoxItem Content="Бронхоскопия"/>
                                    <ComboBoxItem Content="Цистоскопия"/>
                                </ComboBox>

                                <ComboBox x:Name="cbNDiagnosis" 
                                          Grid.Row="4" Grid.Column="1"
                                          Margin="5,5,5,10"
                                          IsEditable="True"
                                          IsTextSearchEnabled="True"
                                          TextSearch.TextPath="Code"
                                          StaysOpenOnEdit="True"
                                          ToolTip="Выберите диагноз по МКБ-10"
                                          PreviewKeyUp="DiagnosisComboBox_PreviewKeyUp">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Code}" FontWeight="Bold" Width="60"/>
                                                <TextBlock Text="{Binding Name}" Margin="5,0,0,0"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Диагноз:" Margin="5"/>

                                <TextBlock Grid.Row="5" Grid.Column="0" Text="Примечания:" Margin="5"/>
                                <TextBox Grid.Row="5" Grid.Column="1" x:Name="NotesTextBox" Margin="5" Height="60" TextWrapping="Wrap" AcceptsReturn="True"/>
                            </Grid>
                        </ScrollViewer>

                        <!-- Подпись -->
                        <StackPanel Grid.Row="1" HorizontalAlignment="Right" Margin="10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Врач: " Margin="0,0,0,5"/>
                                <TextBlock x:Name="txtDoctorInfoFree" Margin="0,0,0,5"/>
                            </StackPanel>
                            <TextBlock Text="Подпись: _______________________"/>
                            <TextBlock Text="М. П." TextAlignment="Center"/>
                        </StackPanel>

                        <!-- Панель инструментов -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="5">
                            <Button Content="Создать направление" Margin="5" />
                            <Button Content="Печать" x:Name="PrintDirection" Margin="5" Click="PrintDirection_Click"/>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </TabItem>
            <!--<TabItem Header="Услуги"/>-->

            <TabItem Header="Листки нетрудоспособности">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="10" x:Name="CertificateForm">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Шапка справки -->
                        <TextBlock Grid.Row="0" Grid.Column="1" TextAlignment="Right" Text="Код формы по ОКУД _______________" Margin="0,0,30,5"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" TextAlignment="Right" Text="Код учреждения по ОКПО _______________" Margin="0,0,30,10"/>

                        <TextBlock Grid.Row="2" Grid.ColumnSpan="1" Text="Министерство здравоохранения РФ" HorizontalAlignment="Center" Margin="30,0,0,0"/>
                        <TextBlock Grid.Row="3" Grid.ColumnSpan="1" TextDecorations="Underline" Text="Областная клиническая больница г. Киров" FontWeight="Bold" HorizontalAlignment="Center" Margin="30,0,0,0"/>

                        <TextBlock Grid.Row="2" Grid.Column="1" Text="Медицинская документация" HorizontalAlignment="Right" Margin="0,0,130,0"/>
                        <TextBlock Grid.Row="3" Grid.Column="1" Text="Форма № 095/y" HorizontalAlignment="Right" Margin="0,0,160,0"/>
                        <TextBlock Grid.Row="4" Grid.Column="1" Text="Утверждена Минздравом СССР" HorizontalAlignment="Right" Margin="0,0,120,0"/>
                        <TextBlock Grid.Row="5" Grid.Column="1" Text="04.10.80 г. № 1030" HorizontalAlignment="Right" Margin="0,0,150,0"/>

                        <TextBlock Grid.Row="6" Grid.ColumnSpan="2" Text="СПРАВКА" FontSize="20" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,10"/>

                        <!-- Основные данные -->
                        <StackPanel Grid.Row="8" Grid.ColumnSpan="2">
                            <TextBlock Text="О временной нетрудоспособности студента, учащегося техникума," FontWeight="DemiBold" HorizontalAlignment="Center"/>
                            <TextBlock Text="профессионально-технического училища, о болезни, карантине" FontWeight="DemiBold" HorizontalAlignment="Center"/>
                            <TextBlock Text="и прочих причинах отсутствия ребенка, посещающего школу," FontWeight="DemiBold" HorizontalAlignment="Center"/>
                            <TextBlock Text="детское дошкольное учреждение (нужное подчеркнуть)" FontWeight="DemiBold" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                            <TextBlock Text="(нужное подчеркнуть)" HorizontalAlignment="Center" Margin="0,0,0,20"/>

                        </StackPanel>

                        <!-- Дата выдачи -->
                        <StackPanel Orientation="Horizontal" Grid.Row="9" Grid.ColumnSpan="2" HorizontalAlignment="Center">
                            <TextBlock TextAlignment="Center" FontSize="14" Text="Дата выдачи " Margin="5"/>
                            <TextBlock x:Name="DateCpNaprTB" Margin="5" TextDecorations="Underline"/>
                        </StackPanel>

                        <!-- Тип получателя -->
                        <ComboBox Grid.Row="10" Grid.ColumnSpan="2" x:Name="RecipientTypeComboBox" Margin="30,0,30,5">
                            <ComboBoxItem Content="Cтудент"/>
                            <ComboBoxItem Content="Учащийся"/>
                            <ComboBoxItem Content="Ребенок, посещающий дошкольное учреждение"/>
                        </ComboBox>

                        <!-- Название учреждения -->
                        <StackPanel Grid.Row="11" Grid.ColumnSpan="2">
                            <TextBox x:Name="InstitutionTextBox" Margin="30,5,30,5"/>
                            <TextBlock Text="Название учебного заведения, дошкольного учреждения" Margin="30,5,30,5"/>
                        </StackPanel>

                        <StackPanel Grid.Row="12" Grid.ColumnSpan="2">
                            <!-- ФИО и дата рождения -->
                            <TextBox x:Name="FullNameTextBox" Margin="30,0,30,5"/>
                            <TextBlock  Text="Фамилия, имя, отчество" Margin="30,0,30,5"/>
                        </StackPanel>

                        <StackPanel Grid.Row="13" Grid.ColumnSpan="2">
                            <TextBlock x:Name="BirthDatePicker" Margin="30,0,30,5"/>
                            <TextBlock Text="Дата рождения (год, месяц, для детей до 1-го года – день)" Margin="30,0,30,5"/>
                        </StackPanel>

                        <StackPanel Grid.Row="14" Grid.ColumnSpan="2">
                            <!-- Диагноз -->
                            <TextBox x:Name="DiagnosisTextBox" Margin="30,0,30,5"/>
                            <TextBlock Text="Диагноз заболевания (прочие причины отсутствия)" Margin="30,0,30,5"/>
                        </StackPanel>

                        <StackPanel Grid.Row="15" Grid.ColumnSpan="2">
                            <!-- Контакт с инфекционными больными -->
                            <StackPanel Orientation="Horizontal" Margin="30,0,30,5">
                                <RadioButton x:Name="NoContactRadio" Content="нет" Margin="0,0,10,0" GroupName="ContactGroup"/>
                                <RadioButton x:Name="YesContactRadio" Content="да" Margin="0,0,10,0" GroupName="ContactGroup"/>
                                <TextBox x:Name="ContactDetailsTextBox" Width="200" IsEnabled="{Binding ElementName=YesContactRadio, Path=IsChecked}"/>
                            </StackPanel>
                            <TextBlock Text="Наличие контакта с инфекционными больными (нет, да, какими)" Margin="30,0,30,5"/>
                        </StackPanel>


                        <StackPanel Grid.Row="16" Grid.ColumnSpan="2">
                            <!-- Период освобождения -->
                            <StackPanel Orientation="Horizontal" Margin="30,0,30,5">
                                <TextBlock Text="Освобожден от занятий, посещений детского дошкольного учреждения" VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Контейнер для динамически добавляемых элементов -->
                            <ItemsControl x:Name="DateRangesContainer" Margin="30,0,30,5">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
                                            <TextBlock Text="с" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                            <DatePicker Width="120" Margin="0,0,10,0"
                                                        SelectedDate="{Binding StartDate, Mode=TwoWay}"/>
                                            <TextBlock Text="по" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                            <DatePicker Width="120" Margin="0,0,10,0"
                                                        SelectedDate="{Binding EndDate, Mode=TwoWay}"/>
                                            <Button Content="-" x:Name="RemoveDateRange" Width="30" Margin="10,0,0,0"
                                                    Click="RemoveDateRange_Click"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- Кнопка добавления нового периода -->
                            <Button Content="+" Width="50" Margin="30,5,30,5" HorizontalAlignment="Left"
                                    Click="AddDateRange_Click"/>
                        </StackPanel>

                        <StackPanel Grid.Row="17" Grid.ColumnSpan="2">
                            <!-- Подпись и печать -->
                            <StackPanel Grid.Row="20" Grid.Column="1" HorizontalAlignment="Right" Margin="0,20,0,0">
                                <TextBlock Text="М.П." FontStyle="Italic" Margin="0,0,0,10"/>
                                <TextBlock Text="Подпись врача_________________" Margin="0,0,50,0"/>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Grid.Row="18" Orientation="Horizontal" Margin="30">
                            <Button Content="Создать" Width="100" Margin="5"/>
                            <Button Content="Печать" Width="100" Margin="5"/>
                            <Button Content="Экспорт в PDF" x:Name="ExportToPdf" Width="130" Margin="5" Click="ExportToPdf_Click"/>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </TabItem>
            
            <TabItem Header="Рецептурные бланки"/>
            <!--<TabItem Header="Анализы"/>-->
            <TabItem Header="Диагностика"/>
        </TabControl>

        <StackPanel Grid.Row="3" Orientation="Horizontal">
            <TextBlock Text="Создано: " FontWeight="Bold" Margin="0,0,0,5"/>
            <TextBlock x:Name="txtDoctorInfoTwo" Margin="0,0,0,5"/>
        </StackPanel>

        <!--Кнопки внизу-->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Завершить прием" Click="CompleteCaseButton_Click" Width="200" Margin="5" TextBlock.Foreground="Black" Background="White"/>
        </StackPanel>
    </Grid>
</Window>
